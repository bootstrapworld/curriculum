<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Asciidoctor 2.0.17">
  <title>Glossary</title>

    <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-TS6D6H9T');</script>
  <!-- End Google Tag Manager -->

  <link rel="stylesheet" href="lib/curriculum.css" />
  <script src="lib/dependency-graph.js"></script>
  <script src="lib/pathway-tocs.js"></script>
  <script src="lib/bootstraplesson.js"></script>
  <script src="lib/dictionaries.js"></script>

  <style>
    div#body .glossary * { font-size: 12pt; }
    div#body #search { background: black; color: white; padding: 5px; margin: 10px 0; }
    div#body #search input { width: 250px; font-size: 14px; margin-left: 15px; }
    @media print {
      #search { display: none; }
    }
  </style>

  <script type="text/javascript">
    configureGraph(graph);
    window.status = "not_ready_to_print";
    // narrow the primitives by url params
    let {pathway, lessons, lesson, solns} = getParams();
    lessons = lesson? [lesson] : lessons || Object.keys(graph);

    function populateGlossary() {

      function possibleEntryWords(word) {
        let entries = [word];
        let root;
        if (word.match(/ies$/)) {
          entries.push(word.replace(/ies$/, 'y'));
        } else if (word.match(/es$/)) {
          root = word.replace(/es$/, '');
          entries.push(root, root + 'e');
        } else if (word.match(/s$/)) {
          entries.push(word.replace(/s$/, ''));
        } else if (word.match(/ied$/)) {
          entries.push(word.replace(/ied$/, 'y'));
        } else if (word.match(/ed$/)) {
          root = word.replace(/ed$/, '');
          entries.push(root, root + 'e');
        } else if (word.match(/ing$/)) {
          root = word.replace(/ing$/, '');
          entries.push(root, root + 'e');
        }
        return entries;
      }

      // if just one lesson, add it to the title
      if(lessons.length == 1) {
        document.getElementsByTagName("h1")[0]
          .innerHTML += " for " + graph[lessons[0]].title;
      } else {
        document.getElementById("wholeGlossary").style.display = 'none';
      }

      // iterate through all the lessons, collecting glossary words
      // and definitions in a Map
      glossary = lessons.map(l => graph[l].glossary || []).flat()
        .reduce((acc, {vocab, description}) => acc.set(vocab,description), new Map());

      const parentDOM = document.getElementById('glossary');

      // sort words alphabetically, then add the appropriate DOM
      [...glossary.keys()].sort()
        .forEach(key => {
        const dt = document.createElement('dt');
        dt.classList.add('hdlist1');
        dt.setAttribute('id', key);
        dt.innerHTML = key;
        parentDOM.appendChild(dt);
        const dd = document.createElement('dd');
        let definitionHTML = glossary.get(key);
        const matches = /@vocab{([^}]+)}/g.exec(definitionHTML);
        if(matches) {
          const vocab = matches[1];
          const possibleWords = possibleEntryWords(vocab);
          const key = possibleWords.find(w => glossary.get(w))
          console.log('found @vocab', matches, 'possibleWords:', possibleWords, 'chosen word', key);
          const link  = `<a href="#${key}">${key}</a>`;
          definitionHTML = definitionHTML.replace(matches[0], link);
        }
        dd.innerHTML = "<p>" + definitionHTML + "</p>";
        parentDOM.appendChild(dd);
      });

    }

    var searchTimeout;
    function search(str) {
      clearTimeout(searchTimeout);
      const dds = [...document.querySelectorAll('dd')];
      const dts = [...document.querySelectorAll('dt')];
      searchTimeout = setTimeout( () => {
        console.time('time to filter');
        const dl = document.querySelector('dl');
        dl.style.display = "none";
        [...glossary.keys()].sort().forEach((word, idx) => {
          // if it's a match, make the dd/dt visible. Otherwise, invisible
          dds[idx].style.display = dts[idx].style.display =
            word.toLowerCase().includes(str)? "inline" : "none";
        });
        dl.style.display = "inline";
        console.timeEnd('time to filter');
      }, 250);
    }
  </script>

  <link rel="stylesheet" type="text/css" href="lib/wp-adaptors/style-overrides.css">
  <link rel="stylesheet" type="text/css" href="lib/wp-adaptors/style-bsw.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
  <script src="lib/wp-adaptors/script.js"></script>

</head>
<body onload="populateGlossary()">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TS6D6H9T"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <!--#include virtual="lib/wp-adaptors/header.ssi" -->
  <div class="x-row x-container max width e4468439224895391-e2 m17zxgn2tjtr-8 m17zxgn2tjtr-9 m17zxgn2tjtr-b">
  <div class="x-row-inner">
  <div class="x-col e4468439224895391-e3 m17zxgn2tjtr-d m17zxgn2tjtr-e m17zxgn2tjtr-f lesson-content">
  <div id="body" class="narrativepage article canBeLongerThanAPage">
    <div id="header">
      <h1>Glossary</h1>
    </div>
    <div id="content">
      <div class="paragraph">
        <span id="wholeGlossary">You are viewing a limited glossary, used in one lesson. <a href="Glossary.shtml">Click here</a> to load the entire glossary for <i>all</i> Bootstrap lessons.</span>
        <p><strong>Note:</strong> We also provide a <a href="lib/bilingual-glossary.html">bilingual glossary</a>, which defines all vocabulary words across our lessons in English and Spanish.</p>
        <div id="search">
            Searching for a word? <input id="searchBox" type="search" onInput="search(this.value)"
            placeholder="Type it here!"/>
        </div>
        <div class="dlist glossary">
          <dl id="glossary">
            <!-- dictionary entries go here -->
          </dl>
        </div>
      </div>
    </div>
  </div>
</div>
<!--#include virtual="lib/wp-adaptors/sidebar/curricula.ssi" -->
</div>
</div>
<!--#include virtual="lib/wp-adaptors/footer.ssi" -->
</body>
</html>
