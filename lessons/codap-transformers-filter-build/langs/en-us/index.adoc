= Transformers
@description{Students learn more about _Transformers_, including `Build` and `Filter`.}

@add-to-lang{.order-by, .filter, .build-column}

[@lesson-intro-table]
|===
@lesson-prereqs{defining-functions}
| Lesson Goals
| Students will be able to...

* filter the Animals Dataset by species, fixed status, and age
* add a column to the Animals Dataset

| Student-facing Lesson Goals
|

* Let’s learn how transform one table into another.

| Materials
|[.materials-links]
* @link{https://docs.google.com/presentation/d/1fONyy_r4GHysWMf4n3eKcYxtO4GfBYTKznRQRFrYoG4/edit?usp=sharing, Lesson Slides}

@material-links

|===

== Filtering Tables @duration{20 minutes}

=== Overview
Students learn how to _filter_ tables by removing Rows.

=== Launch

Announce to the class that you are going to select 6-8 students, each of whom will represent a  unique Row of a dataset called “Students.”  Arrange them in a line at the front of the room.

Tell the class that you are going to select a volunteer who will play the role of… The Filter Transformer!

Hand the Filter Transformer an Expression card from the @opt-printable-exercise{pages/function-cards.adoc, Expression Cards} set.  Publicly tell that student that this is __their expression__. Instruct them to review their expression's name, contract, and purpose statement, but to keep that information a secret.

Explain to the class that the Filter Transformer will walk from one student to the next, referring to their unique expression (on the card) in order to determine if each student should stand or sit.

Here’s how that might look if the Filter Transformer chose a function called `likes-pizza`.

Filter Transformer to Student 1: Do you like pizza?

Student 1: Yes

Filter Transformer: Remain standing. (Student 1 remains standing.)

Filter Transformer to Student 2: Do you like pizza?

Student 2: No.

Filter Transformer: Sit down. (Student 2 sits.)

After the Filter Transformer has applied the expression to each student, ask the class: Based on who sat and who stayed, what expression was the Filter Transformer applying? _What does the Filter Transformer do to a dataset?_

[.lesson-point]
The `Filter` Transformer takes an _expression_, and produces a new table containing only rows for which the expression returns `true`.

=== Investigate

Explain to students that they are going to practice using the `Filter` Transformer; doing so will require them to determin the correct Boolean expression to let CODAP know which cases stay and which cases sit.

Walk students through the process of creating a `Transformer` named `filter-is-fixed`.

[.lesson-instruction]
* Open the Transformer plugin and select `Filter`.
* Enter the `filter-is-fixed` as the Transformer name. What does this name tell you about the Transformer we are creating?
* Select `animals-dataset`.
* Examine the contract. Why does the provided contract make sense?
* Let's write a purpose statement. What do you think a `Transformer` called `filter-is-fixed` ought to do?
* Enter `Fixed = true` as the experssion.
* Select `Apply Transformer`.

Encourage students to pay close attention to details as they enter information into the `Transformers` plugin. What happens if they forget to select a dataset from the drop-down menu? When does the text change colors? Does CODAP mind if spelling is off? What happens when they students 'Save'?

Invite students to create Transformers (and copies of the dataset) for the following scenarios.

[.lesson-instruction]
* Customize a Transformer called `filter-is-old` that creates a new dataset with animals older than 5 years.
* Customize a Transformer called `filter-is-dog` that creates a new dataset with only dogs.

The `Filter` Transformer walks through the table, applying its _expression_ to each row. It then produces a new table containing all the rows for which the expression returned `true`.

=== Synthesize
Debrief with students. Some guiding questions on filtering:

- Suppose we wanted to determine whether cats or dogs get adopted faster. How might using the `Filter` Transformer help?
- If the shelter is purchasing food for older cats, what filter would we write to determine how many cats to buy for?
- Can you think of a situation where filtering fixed animals would be helpful?

== Building Columns @duration{10 minutes}

=== Overview
Students learn how to _build columns_, using the `Build Attribute` Transformer.

=== Launch
Suppose we want to _transform_ our table, converting `pounds` to `kilograms` or `weeks` to `days`. The `Build Attribute` Transformer makes that possible! .

=== Investigate
[.lesson-instruction]
* Open the Transformer plugin and select `Build Attribute`.
* Enter the `build-is-young` as the name. What does this name tell you about the Transformer we are customizing?
* Select `animals-dataset`.
* What would be an appropriate name for our new attribute?
* Examine the contract. A domain is provided, but not a range. When given a row as its input, what is the desired output for `build-is-young`?
* Let's write a purpose statement. What do you think we want a Transformer called `build-is-young` to do?
* Enter `Age < 5` as the expression.
* Apply the Transformer.
* Now, try customizing a Transformer called `build-is-cat`.

The `Build Attribute` Transformer walks through the table, applying whatever expression it was given to each row. Whatever the expression produces for that row becomes the value of our new column, which is named based on the string it was given. In the first example, we gave it `Age < 5`, so the new table had an extra Boolean column for every animal, indicating whether or not it was young.

=== Synthesize
Debrief with students. Ask them if they can think of a situation where they would want to use this. Some ideas:

- A dataset from Europe might list everything in metric (centimeters, kilograms, etc), so we could build a column to convert that to imperial units (inches, pounds, etc).
- A dataset about schools might include columns for how many students are in the school and how many of those students identify as multi-racial. But when comparing schools of different sizes, what we really want is a column showing what _percentage_ of students identify as multi-racial. We could use  to compute that for every row in the table.

Being able to define  is a _huge_ upgrade in our ability to analyze data! But as a wise person once said, "with great power comes great responsibility"! Dropping all the dogs from our dataset might be a cute exercise in this class, but suppose we want to drop certain populations from a national census? Even a small programming error could erase millions of people, impact funding for things like roads and schools, etc.

== Transforming Columns @duration{10 minutes}

=== Overview
Students learn how to _transform columns_, using the `Transform Attribute` Transformer.

=== Launch

=== Investigate

=== Synthesize

== Additional Exercises:
@opt-printable-exercise{pages/what-table-do-we-get.adoc}
