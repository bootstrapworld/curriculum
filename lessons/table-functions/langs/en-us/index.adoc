= Table Functions

@description{Students learn about functions that work with tables, allowing them to filter and build columns}

@lesson-prereqs{functions-examples-definitions, bar-and-pie-charts}

@keywords{circles of evaluation, filter, filtering, sort, sorting, build, building}

@add-to-lang{sort, filter, build-column}

[@lesson-intro-table]
|===

| Lesson Goals
| Students will be able to...

* order the Animals Dataset by a number of criteria
* filter the Animals Dataset by species, fixed status, and age
* add a column to the Animals Dataset

| Student-facing Lesson Goals
|

* Let’s learn how transform one table into another.

| Materials
|[.materials-links]

@material-links

|===

== Review @duration{15 minutes}

[.lesson-instruction]
--
- This activity is about reading carefully and getting more comfortable with row-consuming functions.
- Load the @starter-file{table-functions}, go to the File menu, and click "Save a Copy".
- Take 5 minutes to complete @printable-exercise{pages/row-and-function-definitions.adoc}.
--

* Who can explain what `is-old` does?
** _It looks up the age of the row, and asks if its greater than 10._
* Who can explain what `lookup-name` does?
** _It looks up the value in the `name` column._
* Who can explain what `lookup-fixed` does?
** _It looks up the value in the fixed column._
* Who can explain what `label` does?
** _It prints the animal's name in red._
* Who can explain what `kilos` does?
** _It divides the pounds by 2.2._

Challenge students to use terminology like "looks up the value in the X column" when describing a lookup.

== Filtering Rows, Building Columns @duration{35 minutes}

=== Overview
Students learn to filter the rows and add new columns to a table, using functions they can define themselves.

=== Launch
Select 6-8 students, each of whom will represent a unique Row of a dataset called “Students.”  Arrange them in a line at the front of the room.

Sometimes we want to *filter the rows* of a table by some criteria. In our animals dataset, for example, we might want to filter the table to show only the rows for dogs, or only the rows for cats older than 5. What are some ways to filter our table of students?

[.lesson-roleplay]
--
- Select a volunteer who will play the role of… *filter*!
- Hand the volunteer a function card from the @handout{pages/function-cards.adoc, Function Cards} set. (Choose your students and cards carefully! Some cards only work if you have at least one student with glasses, red hair, etc.)
- Instruct Filter to read the card carefully, making sure they understand what it will do for each "Row" (student!) in the "Table", but to __keep it a secret__.
- Explain to the class that the volunteer playing Filter will walk from one student to the next, referring to the function (on the card) in order to determine if each student should step forward or step backward.

Here’s how that might look if Filter chose a function card `has-glasses`.

- _Filter stands in front of Student 1 and checks if they are wearing glasses._
- *Filter to Student 1 (who wears glasses)*: Step forward. (Student 1 steps forward.)
- _Filter stands in front of Student 2 and checks if they are wearing glasses._
- *Filter to Student 2 (who does not wear glasses)*: Step back. (Student 2 steps back.)
--
- Have your Filter volunteer go through all their peers, applying their card to each one. Based on who stepped forward and backward, what was on the card? Repeat for several cards.
- Give the volunteer a round of applause!

=== Investigate
Pyret Tables have their own functions for filtering tables - and more! Let's explore some of these.

[.lesson-instruction]
Take 10 minutes to complete @printable-exercise{exploring-functions.adoc}

Confirm that students understand the following key ideas:

[.lesson-point]
--
* `filter` consumes a Table and a _function that consumes Rows and produces Booleans_. It produces a new table containing only rows for which the function returns `true`.
* `build-column` consumes a Table, the name of a new column, and a _function that consumes Rows_. It produces a new table with that new column, and fills in the values by applying the function to every Row.
--

[.lesson-instruction]
Complete @printable-exercise{pages/what-table-do-we-get.adoc}.

=== Common Misconceptions
*Students often think that these functions _change_ the table!* In Pyret, all table functions produce a _brand new table_. If we want to save that table and use it later, we need to define it. For example: `cats = filter(animals-table, is-cat)`.

=== Synthesize
Using with Table Functions is a _huge_ upgrade in our ability to analyze data!

- If the shelter is purchasing food for older cats, what filter would we write to determine how many cats to buy for?
- A dataset from Europe might list everything in metric (centimeters, kilograms, etc), so we could build a column to convert that to imperial units (inches, pounds, etc).
- A dataset about sports teams might include columns for how many games each team won and how many they lost, but it's more useful to build a column to see _what percentage of games_ those teams won.
- **What are some ways you might want to filter _your_ dataset?**
- **What are some columns you might want to build for _your_ dataset?**
