= Row and Column Lookups

@description{Students review how to extract individual Rows from a table, then learn how to answer lookup questions by extracting a single value from a Row.}

@lesson-prereqs{contracts-visualizations, functions-examples-definitions}

@keywords{}

[@lesson-intro-table]
|===

| Lesson Goals
| Students will be able to...

@objectives
@objective{Extract any Row from a table in Pyret.}
@objective{Extract the value of any column in a given Row in Pyret.}

| Student-facing Lesson Goals
|

- Let's practice making data visualizations to answer our questions about the data and retrieving information from tables.

| Materials
|[.materials-links]
@material-links

|===

== Row and Column Lookups

=== Overview
Students review value definitions in Pyret, and practice extracting individual Rows for later use. They are also introduced to _column lookups_, which allow them to extract a specific value from a Row.

=== Launch

You've learned how to write functions that work with Numbers, Strings, and Images. But as Data Scientists, we want to write functions that work with _Rows_. To do that, we'll need to take Rows apart and use the values stored in their columns.

@lesson-instruction{
- Open the @starter-file{row-functions} and click "Run".
- What Rows do you see defined here? Evaluate a few of them in the Interactions Area.
}

@slidebreak

@QandA{
@Q{What are the names of the sample rows you see defined?}
@A{`cat-row`, `dog-row`, etc.}

@Q{What function is used to extract a row from the table?}
@A{`row-n`}

@Q{What row would `row-n(animals-table, 1)` return?}
@A{The second row.}
}

@slidebreak

Notice that we could have defined the first row from the animals table using:

`sasha = row-n(animals-table, 0)`

But, it's often more useful to name our Row definitions according to the _property we care about_. In this case, the fact that this row is a cat is _much_ more interesting than the fact that her name is Sasha, so the starter file uses:

`cat-row = row-n(animals-table, 0)`


@slidebreak

If we were analyzing a subset of lizards, it would make sense to add a definition for `lizard-row` to the Animals Dataset.

@lesson-instruction{
- If you were to adopt an animal from the shelter, who would be your favorite?
- Define a new Row called `myPet`, to be your favorite animal at the shelter.
}

@slidebreak

We can access _specific columns_ of a Row, by using a *Row Accessor*.

- start with a row value:
  ** a `row-n` expression just like the ones we've been working with
  ** the name of a row that we have already defined
- end with square brackets `[ ]` containing the name of the column where the value can be found.

Here are three examples that use row accessors to get at different columns from the first row in the animals-table.

@indented{
[cols="1a,1a", options="header"]
|===
| Without Predefined Rows
| Using Predefined Rows

|

```
row-n(animals-table, 0)["name"]
row-n(animals-table, 0)["age"]
row-n(animals-table, 0)["fixed"]
```

|

```
cat-row["name"]
cat-row["age"]
cat-row["fixed"]
```

|===
}

=== Investigate

Sometimes we want to ask questions about a specific Row, or do some computations with that Row:

- Is the age of our `lizard-row` animal more than 3?
- How many _kilograms_ does our `rabbit-row` weigh?
- Is the species of our `fixed-row` animal a `"dog"`?
- Could we use the `age` of our `male-row` as the size of a solid, green triangle?

We can use our knowledge of lookups, operators and functions to do just that!

@lesson-instruction{
- Turn to @printable-exercise{lookup-questions-matching.adoc}.
- Notice the `pet-table` at the top of the page. All of the questions on this page will refer back to that table.
- Complete the page, discussing your thinking with a partner.
}

@teacher{Confirm that students have correctly complete the page before moving on. If they need more matching practice before moving on have them complete @opt-printable-exercise{more-practice-w-lookups.adoc}.}

Now that we know how to lookup a value for a specific column of a row, let's practice some of the things we might be able to do with that information!

@lesson-instruction{
- Return to the @starter-file{row-functions}, and turn to @printable-exercise{lookup-expressions.adoc}
- Notice that the code at the top uses the "age" of `old-row` to determine the size of the triangle.
- Type the code into the Interactions Area and test it out.
- With a partner, work through @printable-exercise{lookup-expressions.adoc}. After you've written the expressions on paper, try them out in Pyret!
}

@teacher{
Have students share their most creative uses of lookups. Did anyone use three or more columns from a Row? Did anyone use more than one Row in the same expression?
}

=== Synthesize

@QandA{
@Q{Why is it helpful to be able to lookup values from a Row?}
@A{Once we have the values, we can use them with any Pyret expression we want!}
@A{We can perform computation on those values, make images, etc.}
}

== Writing Functions with Lookups

=== Overview
Students practice using the Design Recipe to write familiar functions, but this time those functions use Row values and column lookups as part of their expressions.

=== Launch
Could we use use column lookups in some of the functions we've written? Let's try it out!

@lesson-roleplay{
We're going to need another actor...

This time, the role is "nametag". It takes in a name and draws that text in size 20 with blue letters.

When someone says @show{(code '(nametag "Jamal"))}, they reply with @show{(code '(text "Jamal" 20 "blue"))}
}

@teacher{Have students practice calling out colors, with the actor responding.}

@slidebreak

This rehearsing gives us our examples!

```
examples:
  nametag("Baily") is text("Baily", 20 "blue")
  nametag("Shay")  is text("Shay",  20 "blue")
end
```

Circling and labeling the parts that change helps us define the function:

@show{(code '(define (nametag name) (code '(text name 20 "blue"))))}

@slidebreak

@QandA{
@Q{If we wanted to make the letters smaller, what would need to change?}
@A{We'd have to replace the `20` with something smaller}
@Q{What if we wanted to that number to come from the age of `dog-row`?}
@A{We'd have to replace the `20` with a lookup}
}

@slidebreak

```
fun nametage(name): text("name", dog-row["age"], "blue") end
```

=== Investigate

@lesson-instruction{
- With your partner, complete the *first* challenge on @printable-exercise{functions-w-lookups.adoc}
- When you're done, type it into your @starter-file{row-functions} and test it out!
}

@slidebreak

In @lesson-link{functions-make-life-easier}, you defined a function called `sticker`. It took in a color and produced a solid circle of radius 100, of whatever color was passed in:

@center{`fun bigc(color): circle(100, "solid", color) end`}

@QandA{
@Q{What needed to change about this function, to use the age of `old-row` as the size?}
@A{The 100 needed to be replaced with a lookup, extracting `"age"` from `old-row`}
}

@slidebreak

@lesson-instruction{
- With your partner, complete the *second* challenge on @printable-exercise{functions-w-lookups.adoc}
- When you're done, type it into your @starter-file{row-functions} and test it out!
}

@slidebreak

You've already compared a string to a Row lookup. For example, we checked to see if the species of a row was `"cat"`:

@center{`young-row["species"] == "cat"`}

This is _another_ Row lookup, only this time we're comparing the string to the `"name"` column.

@teacher{If necessary, review the solution for this function.}

@slidebreak

@lesson-instruction{
- With your partner, complete the *last* challenge on @printable-exercise{functions-w-lookups.adoc}
- When you're done, type it into your @starter-file{row-functions} and test it out!
}

@slidebreak

This challenge was *very* different from the other two!

@QandA{
@Q{What are some ways this was different?}
@A{The function consumed a row instead of a Number or String.}
@A{The lookup happened on the input argument, instead of on the same row that never changes}
}

=== Synthesize

We started programming by writing simple expressions over Numbers, Strings, and Images. Then we learned how to generalize those expressions into _functions._ Now that we know how to look up values from a Row, we can start generalizing expressions with Rows into _functions with Rows._

- Now we can write functions that check if the species of a Row is a cat. This makes it easy to filter a table to show only the cats!
- Now we can write functions that check if the age of a Row is greater than 10. This makes it easy to filter a table to show only the old animals!

What are some other functions we can write, and how might we use them?
