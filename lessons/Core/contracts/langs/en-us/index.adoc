= Contracts

@description{Students learn how to apply Functions in the programming environment and interpret the information contained in Contracts: Name, Domain and Range. Image-producing functions provide an engaging context for this exploration.}

@lesson-prereqs{simple-data-types}

@keywords{}

@add-to-lang{sqrt, sqr, string-length, string-contains, triangle, star, circle, square, rectangle, ellipse, text, radial-star, isosceles-triangle, right-triangle, star-polygon, triangle/sas, triangle/asa}

[@lesson-intro-table]
|===
| Lesson Goals
| Students will be able to:

* Name and explain the three parts of a Contract
* Use Contracts to apply functions that produce Numbers, Strings, and Images
* Demonstrate understanding of @vocab{Domain} and @vocab{Range} and how they relate to @vocab{Functions}

| Student-facing Lesson Goals
|

* Let's write code to make images!
* Let's learn to identify the Domain and Range of a function.
* Let's use Contracts to apply functions.

| Materials
|[.materials-links]

@material-links

| Supplemental Materials
|[.materials-links]
@opt-material-links

| Preparation
|
* All students should log into @starter-file{editor}.

| Key Points For The Facilitator
|
* Check frequently for understanding of @vocab{data types} and @vocab{contracts} during this lesson and throughout subsequent lessons.

|===

== Applying Functions - Reading Contracts @duration{15 minutes}

=== Overview
Students learn how to apply functions in
	@ifproglang{pyret}{Pyret}
	@ifproglang{wescheme}{WeScheme}
and are introduced to the notion of @vocab{Contracts}, which are a simple notation (based on function notation in Algebra!) for keeping track of the set of all possible inputs and outputs for a function. 

=== Launch
In human languages, verbs _do things to nouns_. For example, I can "_throw_ a ball", or "_eat_ a sandwich". "Throw" and "Eat" are verbs, and "ball" and "sandwich" are nouns.

In programming languages, values are like nouns. You've learned about values in our programming language, like Numbers (`42`, `-8.3`, etc), Strings (`"hello!"`), and Booleans (`true` and `false`). @ifproglang{pyret}{We already know _some_ verbs, like `+`, and `-` ... each of which _does something_ to Numbers.}

In programming, our verbs are called @vocab{functions}. A function is like a machine, and it does three things:

- It takes in some values (called @vocab{arguments}).
- It _does something_ to those values.
- It produces a new value.

Let's play with a function to get the hang of it.

@lesson-instruction{
- Log into @starter-file{editor} and click "Run".
- Then type @show{(code '(string-length "rainbow"))} into the Interactions Area and hit Enter.
}

@teacher{
Encourage students to try giving different arguments to `string-length`. 

- Does it only work with Strings? 
- Does it only take one String? 

Be sure to discuss and analyze different error messages encountered.
}

@QandA{

@Q{What does the function `string-length` do?}
@A{It counts the number of characters in a string and returns the value.}

@Q{How many arguments does `string-length` expect?}
@A{1}

@Q{What type of argument does the function expect?}
@A{String}

@Q{What does the expression @show{(code '(string-length "rainbow"))} evaluate to?}
@A{7}

@Q{What type of data did `string-length` produce?}
@A{Number}
}

=== Investigate

@lesson-instruction{
With your partner, complete @printable-exercise{pages/applying-functions.adoc}. 
}

@QandA{
@Q{What data type did the `regular-polygon` expressions produce?}
@A{An Image! New data type!}

@Q{What are the three parts of a contract?}
@A{*Name* -- the name of the function, which we type in whenever we want to use it}
@A{*Domain* -- the type(s) of data we give to the function}
@A{*Range* -- the type of data the function produces}

@Q{Where else have you heard the word "contract" used in the real world? How can you connect that meaning to contracts in programming? _Answers will vary!_}
@A{An actor signs a Contract agreeing to perform in a film in exchange for a fee and royalties.}
@A{A contractor makes an agreement with a homeowner about what they will build or repair in a set amount of time for a predetermined price.}
@A{A parent agrees to pizza for dinner in exchange for the child completing their chores.}
@A{A student agrees to certain behavioral expectations in order to have access to computers at school or participate in an overnight trip.}
}

@lesson-point{
A Contract in programming is an agreement between what the function is given and what it produces.
}


@lesson-instruction{
- Let's practice *reading* contracts. With your partner, complete @printable-exercise{pages/practicing-contracts.adoc} and @printable-exercise{pages/matching-expressions.adoc}. 
- _Note: Neither of these pages are designed to be used with Pyret!_
}

@QandA{
@Q{Which expression satisfied the contract for `is-beach-weather`?}
@A{D}

@Q{Which expression satisfied the contract for `cylinder`?}
@A{C}
}

@optional We've just encountered a lot of new vocabulary! Help students solidify their understanding and surface misconceptions by giving them a chance to explain the concepts of @opt-printable-exercise{pages/frayer-model.adoc, Domain and Range} and/or @opt-printable-exercise{pages/frayer-model-2.adoc, Function and Variable} in their own words, using these Frayer Model visual organizers.

@strategy{
@span{.title}{Strategies for English Language Learners}

MLR 2 - Collect and Display: As students explore, walk the room and record student language relating to functions, domain, range, contracts, or what they perceive from error messages.  This output can be used for a concept map, which can be updated and built upon, bridging student language with disciplinary language while increasing sense-making.
}

=== Common Misconception

@vocab{Contracts} don't tell us _specific_ inputs. They tell us the _@vocab{data type}_ of each input a function needs. 

For example, a Contract wouldnâ€™t say that addition requires "3 and 4". Addition works on more than just those two inputs! Instead, it would tells us that addition requires "two Numbers". When we _use_ a Contract, we plug specific numbers or strings into the expression we are coding.

@lesson-point{
Contracts are general. Expressions are specific.
}

@ifproglang{pyret}{
@vocab{Arguments} (or "inputs") are the _values_ passed into a function. This is different from @vocab{variables}, which are the placeholders that get _replaced_ with those arguments! 
}

=== Synthesize

- How would you explain Domain and Range to someone who missed today's class?
- What questions do you have about Contracts?


@ifproglang{pyret}{
@strategy{
@span{.title}{Connecting to Function Notation}	
If your students are already familiar with function notation, Pyret mirrors it precisely, so this is a terrific opportunity to make the connection! 

_If your students are not yet familiar with function notation, no need to introduce it now... it will make more sense to introduce once they are fluent in how Pyret works, and we have an entire @lesson-link{function-notation} lesson devoted to making the connection._
}
}

== Bug Hunting @duration{10 minutes}

=== Overview
This activity digs deeper into Contracts by focusing on what we can learn from error messages. The error messages in this environment are _designed_ to be as student-friendly as possible. 

Encourage students to read these messages aloud to one another, and ask them what they think the error message _means_. By explicitly drawing their attention to errors, you will be setting them up to be more independent in the future!

=== Launch

Now that we know what a contract is, let's see how error messages in 
@ifproglang{wescheme}{WeScheme}
@ifproglang{pyret}{Pyret}
can help us to figure out the contract for a function we've never seen before.

@lesson-instruction{
* Let's complete the first section of @printable-exercise{catching-bugs.adoc} together. We'll be working in @starter-file{editor}.
* Start by typing `triangle` into the Interactions Area.
}

@QandA{
@Q{When you type `triangle` into the Interactions Area you get @ifproglang{pyret}{`<function:triangle>`}
@ifproglang{wescheme}{`#<function:triangle>`}. 
What does it mean?}
@A{There is something called "triangle", and the computer knows it's a function!}
}

@lesson-instruction{
* We know that all functions will need an open parentheses and at least one input! 
* Type @show{(code '(triangle 80))} in the Interactions Area and read the error message.
}

@QandA{
@Q{What _hint_ does the error message give us about how to use this function?}
@A{@image{images/triangle80.png, 500}}
@A{`triangle` has three elements in its Domain. And if we don't give it those three things we'll get an error instead of the star we want.}
}

@lesson-instruction{
* Now that we know that `triangle` needs 3 arguments, experiment to find some expressions that will satisfy the function and successfully build triangles and see if you can figure out the Contract for `triangle`!}

@QandA{
@Q{What is the Contract for `triangle`?}
@A{@show{(contract `triangle `(Number String String) "Image")}}
}

=== Investigate

Diagnosing and fixing errors are skills that we will continue developing throughout this course. 

@lesson-instruction{
Turn to the second section of @printable-exercise{pages/catching-bugs.adoc} with your partner and try to explain the difference between syntax and contract errors in your own words.
}

@QandA{
@Q{What is the difference between a contract error and a syntax error?}
@A{@vocab{syntax errors} are little typos (including missing commas, quotes, parentheses, etc.) that get in the way of the computer being able to read the code.}
@A{@vocab{contract errors} are when we don't give the function the arguments it needs - either because we give it the wrong number or type of arguments.}
}

@lesson-instruction{
* Turn to the third section of @printable-exercise{pages/catching-bugs.adoc}.
* With your partner, read each error message carefully, decide whether it's a contract error or a syntax error and work to decipher what it's trying to tell us.
}

=== Synthesize

- What kinds of @vocab{syntax errors} did you find?
- What kinds of @vocab{contract errors} did you find?

== Exploring Image Functions @duration{20 minutes}

=== Overview

This activity digs deeper into Contracts. Students explore image functions to take ownership of the concept and create an artifact they can refer back to. Making images is highly motivating, and encourages students to get better at both reading error messages and persisting in catching bugs.

=== Launch

@lesson-instruction{
- Turn to @printable-exercise{image-contracts.adoc} and find `triangle`.
- You'll see that both the contract and a working expression have been recorded for you.
- Take the next 10 minutes to experiment with trying to build other shapes using the functions listed.
- As you find expressions that satisfy the functions, record the contracts and the code!
}

@strategy{

@span{.title}{Supporting Diverse Learners}

This open-ended exploration is a low threshold / high-ceiling activity that should be engaging to all students. Do not try to keep your students in lock-step. Some students may find the contracts for all of these functions, but most students will not! What is important here is for everyone to have the opportunity to explore. 

Later in this lesson students will be guided through more scaffolded and in-depth reflection on `isosceles-triangle`, `right-triangle`, `ellipse`, `rhombus`, `regular-polygon` and `radial-star`. There are also optional pages for digging deeper into `star-polygon`, `triangle-asa` and `triangle-sas`. 

The upcoming pages are designed to engage student thinking regardless of whether or not they have previewed all of the functions.
}

In order to make sure that all students both remain engaged and are prepared to engage in productive class discussion, when you become aware that the first student in your class has successfully used the `text` function, give your students the following directions:

@lesson-instruction{
Please focus your remaining few minutes on finding contracts for `star`, `rectangle` and `text` if you haven't already.	
}

=== Investigate

@QandA{
@Q{Does having the same Domain and Range mean that two functions do the same things?}
@A{No! For instance, `square`, `star`, `triangle` and `circle` all have the same Domain and Range, yet they make very different images because they have different function Names, and each of those functions are defined to do something very different with the inputs!}	

@Q{What error messages did you see?}
@A{Error messages include: too few / too many arguments given, missing parentheses, etc.}
@Q{How did you figure out what to do after seeing an error message?}
@A{Reading the error message and thinking about what the computer is trying to tell us can inform next steps.}
}

@strategy{
@span{.title}{Students as Teachers}
It can be empowering for students to develop expertise on a topic and get to share it with their peers! This section of the lesson could be reframed as an opportunity for students to become experts in an image-producing function and teach their classmates about it. For example, Pair 1 and pair 4 might focus on `radial-star`, pair 2 and pair 5 might focus on `polygon-star`, pair 3 and pair 6 might focus on `regular-polygon`, etc. First, each pair would explore their function. Perhaps each pair could make a poster, starter-file or slide deck about their function including: the Contract, an explanation of how it works in their own words, a few images that it can generate illustrating the range of possibilities with the expressions that generate them. Next, they might compare their thinking with another pair that focused on the same Contract. Finally, pairs could be grouped with other pairs who focused on different functions and teach each other about what they learned.
}

@lesson-instruction{
- Let's do some more experimenting with some of the more complex image functions from the list we just saw! This time around we'll start with their contracts.
- Complete @printable-exercise{pages/triangle-contracts.adoc}, @printable-exercise{pages/using-contracts.adoc} and @printable-exercise{pages/radial-star.adoc} with your partner.
}

@optional

- If your students are ready to dig into more complex triangles, you can also have them work through @opt-printable-exercise{pages/triangle-contracts-cont.adoc}.
- Students can also explore  @opt-printable-exercise{pages/star-polygon.adoc}. 

@teacher{Note: Both `star-polygon` and `radial-star` generate a wide range of really interesting shapes!}

@strategy{
@span{.title}{Resolving Contract Errors}
If you see an error and you know the syntax is right, ask yourself these three questions:

- What is the function that is generating that error?
- What is the Contract for that function?
- Is the function getting what it needs, according to its Domain?
}

=== Synthesize

- A lot of the Domains for shape functions are the same, but some are different. Why did some shape functions need more inputs than others?
- Was it harder to find contracts for some of the functions than others? Why?
- How was it different to code expressions for the shape functions when you started with a Contract?

== Composing with Circles of Evaluation @duration{10 minutes}

=== Overview

Students learn to work with more than one function at once, by way of Circles of Evaluation, a visual representation of the underlying structure.

=== Launch

What if we wanted to see your name written on a diagonal? 

* We know that we can use the `text` function to make an Image of your name.

@hspace{2em} @show{(contract 'text '((message String) (size Number) (color String)) "Image")}

*  @ifproglang{pyret}{Pyret}
@ifproglang{wescheme}{WeScheme}
also has a function called `rotate` that will rotate any Image a specified number of degrees.

@hspace{2em} @show{(contract 'rotate '(Number Image) "Image")}

[.big]
_But how could the `rotate` and `text` functions work together?_

=== Investigate

One way to organize our thoughts is to diagram what we want to do, using the Circles of Evaluation. The rules are simple:

1) Every Circle of Evaluation must have one - and only one! - function, written at the top.

2) The arguments of the function are written left-to-right, in the middle of the Circle.

Values like Numbers, String, and Booleans are still written by themselves. Itâ€™s only when we want to _use a function_ that we need to draw a Circle, and write the values inside from left-to-right.

3) Circles can contain other Circles!


If we want to see the `text` "Diego" written in yellow, size 150 and rotated 90 degrees so that it's vertical, our diagram would look like this.

@do{
(define exp1 '(rotate 90 (text 150 "Diego" "yellow")))
}

@show{(coe exp1)}

To convert a Circle of Evaluation into code, we start at the outside and work our way in. After each function we write a pair of parentheses, and then convert each argument inside the Circle. The code for this Circle of Evaluation would be: 

@show{(code exp1)}

@lesson-instruction{Draw the Circle of Evaluation and write the code for printing your name in your favorite color and rotating it so that it's diagonal.}

=== Synthesize

- There were a lot of options for how many degrees to rotate your name in order to make it diagonal! What did you choose? Why? 
- What Numbers wouldn't have made your name diagonal? Why?
- What did you Notice?
- What did you wonder?

== Additional Exercises
@ifproglang{pyret}{
- @opt-online-exercise{https://teacher.desmos.com/activitybuilder/custom/5fc90a1937b6430d836b67e7, Matching Images to Code}
}
@ifproglang{wescheme}{
- @opt-online-exercise{https://teacher.desmos.com/activitybuilder/custom/5fecf203a29e040d182be6c6?collections=5fbecc2b40d7aa0d844956f0, Matching Images to Code}
}

