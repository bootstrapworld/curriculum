== Using the Makefile

The `Makefile` in the top directory allows to you build the
documentation system. Simply type `make`: This creates or updates the
`distribution` subdirectory with the various files
needed for the user.

You may also set a small number of environment variables on the
`make` command-line to further guide the build. These variable
settings may be combined.

=== PDF and workbook generation

By default, `make` won't create the PDF versions of the HTML files, nor the
collections of them that form the various workbooks. PDF and
workbook construction can be time-consuming process that can be
relegated to the final run, when the author is sure that the HTML
conversions have been thoroughly debugged. Once they are, and the
PDFs are desired, set the variable `BOOK` at the `make` command
line to a nonempty string, e.g.,

    make BOOK=yes

=== Link checking

By default, the checking of the various internal and external
links in the documents are not checked -- because it can be a
time-consuming process when its results are actively being
sought. To enable link checking, set the `LINKCHECK` variable to
nonempty, e.g.,

    make LINKCHECK=yes

=== Dependency graph generation

By default, no dependency graph is generated. To generate one at
`distribution/en-us/dependency-graph.js`, set the `GRAPH`
variable to nonempty, e.g.,

    make GRAPH=yes

The dependency graph shows how the various lessons depend on one
another.

=== Making from scratch

To remove a previously made distribution entirely, do

    make clean

The next `make` -- with whatever options you desire -- will be on
a fresh slate.

=== Deploying to websit

To deploy a built distribution to the website, do

    make deploy

Deployment is described in more detail in the repo's README.

=== For users of legacy build-pathway

Before the Makefile-based system was implemented, builds were done using a Bash
script called `build-pathway`.  For those familiar with its usage and unable to
let go, a new script `build` is provided whose API is similar to
`build-pathway`, and which is actually a wrapper that calls the new `make`
under the hood.

NOTE: The new name `build` is used  because `build-pathway` (singular) would a
bit of a misnomer: the underlying `make` always creates or updates _all_
pathways (i.e., courses). Nevertheless, for those who really can't help using
the old name, `build-pathway` is provided a trivial identity wrapper for
`build`. Just remember that you cannot chose one pathway to build: Such
arguments are ignored with a helpful diagnostic.

`build` takes the following options:

- `--book` (aka `--pdf`, `-b`): generates PDFs, both for
  individuals and the workbooks
- `--force` (aka `--superforce`, `--super-force`, `-f`, `-F`):
  builds from scratch, scrubbing any previous `distribution/`
- `--graph` (aka `-g`): generates the lesson dependency graph
- `--help` (aka `-h`): displays help and exists
- `--link` (aka `--verify-links`, `-l`): verify all the links in
  the documentation
- `--natlang L`: builds doc for the natural language `L`
  (default: `en-us`)

Options may be combined in any order.

NOTE: The `--help`
option overwhelms all other options: help is displayed but no building takes
place.

TIP: Use `-fb` or `-bf` for the often useful combination of
`--force` and `--book`.

TIP: An experimental option `--adocjs` is provided that tells the
build to use the Node
version of Asciidoctor rather than the Ruby one.

// last modified 2023-03-01
